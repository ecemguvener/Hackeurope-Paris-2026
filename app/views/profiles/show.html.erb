<div class="w-full max-w-4xl mx-auto py-10 px-4">
  <div class="text-center mb-10 animate-fade-in">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">Your Profile</h1>
    <p class="text-gray-600">Reading preferences and document history.</p>
  </div>

  <%# Stats summary row %>
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8 animate-fade-in-up delay-100">
    <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 text-center hover-lift relative overflow-hidden">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500 to-indigo-600"></div>
      <p class="text-3xl font-bold text-gradient"><%= @documents.count %></p>
      <p class="text-sm text-gray-500 mt-1">Documents</p>
    </div>
    <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 text-center hover-lift relative overflow-hidden">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-emerald-500 to-emerald-600"></div>
      <p class="text-3xl font-bold text-gradient"><%= @documents.count(&:version_selected?) %></p>
      <p class="text-sm text-gray-500 mt-1">Selections Made</p>
    </div>
    <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 text-center hover-lift relative overflow-hidden">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-amber-500 to-amber-600"></div>
      <p class="text-3xl font-bold text-gradient"><%= @user.preferred_style.present? ? @user.preferred_style : "—" %></p>
      <p class="text-sm text-gray-500 mt-1">Preferred Style</p>
    </div>
  </div>

  <%# Preferred Style %>
  <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 mb-8 animate-fade-in-up delay-200 relative overflow-hidden">
    <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
    <h2 class="text-lg font-bold text-gray-900 mb-3">Preferred Style</h2>
    <% if @user.preferred_style.present? %>
      <div class="flex items-center gap-3">
        <span class="inline-block bg-indigo-100 text-indigo-700 font-semibold px-4 py-2 rounded-lg text-lg">
          <%= @user.preferred_style %>
        </span>
      </div>
    <% else %>
      <p class="text-gray-500">No preference saved yet — <%= link_to "upload a document", upload_path, class: "text-indigo-600 font-medium hover:text-indigo-500" %> to get started.</p>
    <% end %>
  </div>

  <%# Accessibility Profile %>
  <% if @user.profile.present? && @user.profile.keys.any? %>
    <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 mb-8 animate-fade-in-up delay-300 relative overflow-hidden">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-emerald-500 to-teal-500"></div>
      <h2 class="text-lg font-bold text-gray-900 mb-4">Accessibility Profile</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <% @user.profile.each do |key, value| %>
          <div class="flex items-center justify-between bg-gray-50 rounded-lg px-4 py-3">
            <span class="text-sm text-gray-600 font-medium"><%= key.to_s.titleize %></span>
            <span class="text-sm font-semibold text-gray-900"><%= value.to_s %></span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Reading Assessment %>
  <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 mb-8 animate-fade-in-up delay-350 relative overflow-hidden">
    <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-fuchsia-500 to-indigo-500"></div>
    <h2 class="text-lg font-bold text-gray-900 mb-2">Reading Assessment (Dyslexia Check)</h2>
    <p class="text-sm text-gray-600 mb-4">
      Retype the sentence below and describe what feels difficult. This helps personalize transformations.
    </p>

    <div class="rounded-lg border border-fuchsia-200 bg-fuchsia-50 p-4 mb-4">
      <p class="text-sm text-fuchsia-700 font-medium">Sentence to retype:</p>
      <p class="text-base text-gray-900 mt-1"><%= ReadingTestAnalyser::TEST_SENTENCE %></p>
    </div>

    <%= form_with url: profile_assessment_path, method: :post, data: { controller: "reading-test", action: "submit->reading-test#stamp" } do |f| %>
      <div class="space-y-4">
        <div>
          <label for="retyped_text" class="block text-sm font-medium text-gray-700 mb-1">Retyped sentence</label>
          <%= f.text_area :retyped_text, id: "retyped_text", rows: 3, required: true,
                class: "w-full rounded-lg border border-gray-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
        </div>
        <div>
          <label for="self_described_difficulty" class="block text-sm font-medium text-gray-700 mb-1">What felt difficult?</label>
          <%= f.text_area :self_described_difficulty, id: "self_described_difficulty", rows: 3, required: true,
                placeholder: "e.g. long words, letter swaps, losing place in sentence...",
                class: "w-full rounded-lg border border-gray-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
        </div>
      </div>

      <%= f.hidden_field :time_taken_seconds, value: 1, data: { reading_test_target: "time" } %>

      <div class="mt-4">
        <%= f.submit "Save Assessment",
              class: "inline-block text-white font-semibold py-2 px-5 rounded-lg bg-gradient-to-r from-fuchsia-600 to-indigo-600 hover:from-fuchsia-500 hover:to-indigo-500 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" %>
      </div>
    <% end %>
  </div>

  <%# Document History %>
  <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 animate-fade-in-up delay-400 relative overflow-hidden">
    <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-amber-500 to-orange-500"></div>
    <h2 class="text-lg font-bold text-gray-900 mb-4">Document History</h2>
    <% if @documents.any? %>
      <div class="divide-y divide-gray-100">
        <% @documents.each do |document| %>
          <div class="flex items-center justify-between py-4">
            <div>
              <p class="font-medium text-gray-900">
                <%= document.file.attached? ? document.file.filename : "Document ##{document.id}" %>
              </p>
              <p class="text-sm text-gray-500">
                Uploaded <%= document.created_at.strftime("%b %d, %Y at %l:%M %p") %>
              </p>
            </div>
            <div class="flex items-center gap-3">
              <% if document.version_selected? && document.selected_style %>
                <span class="text-xs bg-green-100 text-green-700 font-medium px-2 py-1 rounded-full">
                  <%= document.selected_style[:title] %>
                </span>
                <%= link_to "View", collapsed_show_path(document),
                      class: "text-sm text-indigo-600 font-medium hover:text-indigo-500" %>
              <% else %>
                <span class="text-xs bg-gray-100 text-gray-500 font-medium px-2 py-1 rounded-full">
                  Not yet chosen
                </span>
                <%= link_to "View", results_path(document),
                      class: "text-sm text-indigo-600 font-medium hover:text-indigo-500" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8">
        <p class="text-gray-500 mb-4">No documents yet — upload your first one!</p>
        <%= link_to "Upload a Document", upload_path,
              class: "inline-block text-white font-semibold py-2 px-6 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 shadow-lg transition-all" %>
      </div>
    <% end %>
  </div>
</div>
