<%# Upload page — Step 1 of 3 %>
<div class="min-h-[80vh] flex items-start justify-center px-4 pt-10">
  <div class="w-full max-w-xl animate-fade-in">

    <%# ── Step indicator ─────────────────────────────────────────── %>
    <nav aria-label="Upload progress steps" class="mb-8">
      <ol class="step-list">
        <li class="step-item step-active" aria-current="step">
          <span class="step-num" aria-hidden="true">1</span>
          <span>Upload</span>
        </li>
        <div class="step-connector" aria-hidden="true"></div>
        <li class="step-item">
          <span class="step-num" aria-hidden="true">2</span>
          <span>Transform</span>
        </li>
        <div class="step-connector" aria-hidden="true"></div>
        <li class="step-item">
          <span class="step-num" aria-hidden="true">3</span>
          <span>Listen</span>
        </li>
      </ol>
    </nav>

    <%# ── Page heading ────────────────────────────────────────────── %>
    <h1 class="text-3xl font-bold text-stone-800 mb-2">
      Upload your document
    </h1>
    <p class="text-stone-500 mb-8 text-base leading-relaxed max-w-md">
      We'll extract the text and create dyslexia-friendly versions for you to compare and choose from.
    </p>

    <%# ── Error alert ────────────────────────────────────────────── %>
    <% if flash[:alert] %>
      <div role="alert"
           class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-xl mb-6 text-sm font-medium">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <%# ── Upload form ─────────────────────────────────────────────── %>
    <%= form_with url: upload_path, method: :post, multipart: true,
          class: "space-y-5",
          data: { controller: "dropzone" } do |f| %>

      <%# Drop zone %>
      <div class="border-2 border-dashed border-stone-300 rounded-2xl p-10 sm:p-14 text-center
                  hover:border-indigo-400 hover:bg-indigo-50/30 transition-all
                  bg-white cursor-pointer group"
           data-dropzone-target="zone"
           data-action="dragenter->dropzone#dragenter dragover->dropzone#dragover dragleave->dropzone#dragleave drop->dropzone#drop"
           role="region"
           aria-label="File upload area — drag and drop or click to browse">

        <%# Upload icon %>
        <svg class="mx-auto mb-5 h-14 w-14 text-stone-300 group-hover:text-indigo-400 transition-colors"
             fill="none" stroke="currentColor" viewBox="0 0 48 48" aria-hidden="true">
          <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>

        <%# File input label (acts as the click target) %>
        <label for="document_file" class="cursor-pointer block">
          <span class="text-indigo-600 font-semibold hover:text-indigo-500 text-lg">Choose a file</span>
          <span class="text-stone-500 text-lg"> or drag and drop</span>
        </label>

        <input type="file"
               name="document[file]"
               id="document_file"
               accept=".txt,.pdf,.png,.jpg,.jpeg"
               class="sr-only"
               data-dropzone-target="input"
               aria-describedby="file-format-hint file-name">

        <p id="file-format-hint" class="text-sm text-stone-400 mt-3">
          PDF, PNG, JPG or plain text &mdash; up to 5&nbsp;MB
        </p>

        <%# Selected file name (updated by dropzone controller) %>
        <p id="file-name"
           class="text-sm text-indigo-600 font-semibold mt-2 min-h-[1.5rem]"
           data-dropzone-target="filename"
           aria-live="polite"
           aria-atomic="true"></p>
      </div>

      <%# Submit %>
      <button type="submit"
              class="w-full bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700
                     text-white py-3.5 px-6 rounded-xl font-semibold text-lg
                     shadow-md hover:shadow-lg transition-all
                     focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
        Extract &amp; Transform
      </button>
    <% end %>

    <%# ── What happens next ───────────────────────────────────────── %>
    <div class="mt-10 grid grid-cols-1 sm:grid-cols-3 gap-4" aria-label="What happens after upload">
      <div class="bg-white rounded-xl border border-stone-200 p-4 text-center">
        <div class="text-2xl mb-2" aria-hidden="true">&#128196;</div>
        <p class="text-sm font-semibold text-stone-700">Extract</p>
        <p class="text-xs text-stone-400 mt-0.5">Text pulled from any format</p>
      </div>
      <div class="bg-white rounded-xl border border-stone-200 p-4 text-center">
        <div class="text-2xl mb-2" aria-hidden="true">&#9889;</div>
        <p class="text-sm font-semibold text-stone-700">Transform</p>
        <p class="text-xs text-stone-400 mt-0.5">4 dyslexia-friendly versions</p>
      </div>
      <div class="bg-white rounded-xl border border-stone-200 p-4 text-center">
        <div class="text-2xl mb-2" aria-hidden="true">&#127925;</div>
        <p class="text-sm font-semibold text-stone-700">Listen</p>
        <p class="text-xs text-stone-400 mt-0.5">Optional text-to-speech</p>
      </div>
    </div>

  </div>
</div>
